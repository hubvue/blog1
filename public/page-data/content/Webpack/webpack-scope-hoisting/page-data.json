{"componentChunkName":"component---src-templates-blog-post-js","path":"/content/Webpack/webpack-scope-hoisting/","result":{"data":{"site":{"siteMetadata":{"title":"Kim Blog","author":"Kim"}},"markdownRemark":{"id":"11eacd59-e2ad-5dea-aad5-eeee9acdebf5","excerpt":"webpack äº§å‡ºç‰©å­˜åœ¨çš„é—®é¢˜ webpack ä¸‡ç‰©çš†æ¨¡å—çš„ç†å¿µï¼Œæ¯ä¸€ä¸ª js éƒ½æ˜¯ä¸€ä¸ª JavaScript æ¨¡å—ã€‚ä¸€ä¸ª bundle æ˜¯ç”±å¤šä¸ª module åˆæˆçš„ï¼Œä¸€ä¸ª bundle æ˜¯ä¸€ä¸ª js æ–‡ä»¶ï¼Œæ‰€ä»¥ webpack è‡ªå·±å®ç°äº†ä¸€å¥— commonjs è§„èŒƒç”¨äºè®© jsâ€¦","html":"<h2>webpack äº§å‡ºç‰©å­˜åœ¨çš„é—®é¢˜</h2>\n<p>webpack ä¸‡ç‰©çš†æ¨¡å—çš„ç†å¿µï¼Œæ¯ä¸€ä¸ª js éƒ½æ˜¯ä¸€ä¸ª JavaScript æ¨¡å—ã€‚ä¸€ä¸ª bundle æ˜¯ç”±å¤šä¸ª module åˆæˆçš„ï¼Œä¸€ä¸ª bundle æ˜¯ä¸€ä¸ª js æ–‡ä»¶ï¼Œæ‰€ä»¥ webpack è‡ªå·±å®ç°äº†ä¸€å¥— commonjs è§„èŒƒç”¨äºè®© js æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ã€‚</p>\n<p>æ¥ä¸€ä¸ª ğŸŒ°ï¼š\næ¯”å¦‚è¯´æœ‰ 3 ä¸ªæ¨¡å—ï¼Œindex.jsã€add.jsã€sum.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//add.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sum.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token parameter\">arr</span> <span class=\"token operator\">=></span> arr<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">pre<span class=\"token punctuation\">,</span> item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> pre <span class=\"token operator\">+</span> item<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//index.js</span>\n<span class=\"token keyword\">import</span> sum <span class=\"token keyword\">from</span> <span class=\"token string\">'./sum'</span>\n<span class=\"token keyword\">import</span> add <span class=\"token keyword\">from</span> <span class=\"token string\">'./add'</span>\n\n<span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>æ‰“å‡ºæ¥çš„ä»£ç å¦‚ä¸‹(åˆ é™¤ä¸€äº›æ— ç”¨çš„ä»£ç )ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">modules</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> installedModules <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">__webpack_require__</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">moduleId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>installedModules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> installedModules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>exports\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> module <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>installedModules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      i<span class=\"token punctuation\">:</span> moduleId<span class=\"token punctuation\">,</span>\n      l<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      exports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    modules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>\n      module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>\n      module<span class=\"token punctuation\">,</span>\n      module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>\n      __webpack_require__\n    <span class=\"token punctuation\">)</span>\n    module<span class=\"token punctuation\">.</span>l <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token keyword\">return</span> module<span class=\"token punctuation\">.</span>exports\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">__webpack_require__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>__webpack_require__<span class=\"token punctuation\">.</span>s <span class=\"token operator\">=</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/***/</span> <span class=\"token string\">'./src/add.js'</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">/***/</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">module<span class=\"token punctuation\">,</span>\n    __webpack_exports__<span class=\"token punctuation\">,</span>\n    __webpack_require__</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'use strict'</span>\n    <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'__webpack_require__.r(__webpack_exports__);\\n// add.js\\n/* harmony default export */ __webpack_exports__[\"default\"] = ((a, b) => a + b);\\n\\n\\n//# sourceURL=webpack:///./src/add.js?'</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">/***/</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">/***/</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">/***/</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">module<span class=\"token punctuation\">,</span>\n    __webpack_exports__<span class=\"token punctuation\">,</span>\n    __webpack_require__</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'use strict'</span>\n    <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _sum__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sum */ \"./src/sum.js\");\\n/* harmony import */ var _add__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add */ \"./src/add.js\");\\n\\n\\n\\nlet a = 1,\\n  b = 2,\\n  arr = [1, 2, 3, 4, 5]\\n\\nconsole.log(Object(_add__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(a, b))\\nconsole.log(Object(_sum__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(arr))\\n\\n\\n//# sourceURL=webpack:///./src/index.js?'</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">/***/</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">/***/</span> <span class=\"token string\">'./src/sum.js'</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">/***/</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">module<span class=\"token punctuation\">,</span>\n    __webpack_exports__<span class=\"token punctuation\">,</span>\n    __webpack_require__</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'use strict'</span>\n    <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'__webpack_require__.r(__webpack_exports__);\\n// sum.js\\n/* harmony default export */ __webpack_exports__[\"default\"] = (arr => arr.reduce((pre, item) => pre + item, 0));\\n\\n\\n//# sourceURL=webpack:///./src/sum.js?'</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">/***/</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>å¯ä»¥çœ‹å‡ºç”± webpack æ‰“åŒ…å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå¤§å¤§çš„ IIFEï¼Œä¸Šé¢ä¸€å¤§å †æ˜¯ webpack è‡ªå·±å®ç°çš„ commonjs è§„èŒƒï¼Œä¸‹é¢çš„ä¼ å‚æ˜¯æˆ‘ä»¬çš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡º webpack æŠŠæˆ‘ä»¬çš„ä»£ç çš„æ¯ä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨ IIFE æ¥åšæ¨¡å—åŒ–ï¼Œæ­£å¼å› ä¸ºå¦‚æ­¤ï¼Œé—®é¢˜å‡ºæ¥äº†ã€‚</p>\n<p><strong>å¤§é‡çš„å‡½æ•°é—­åŒ…åŒ…è£¹ä»£ç ï¼Œå¯¼è‡´ä½“ç§¯å¢å¤§ï¼Œæ¨¡å—è¶Šæ¥è¶Šæ˜æ˜¾ï¼Œè¿è¡Œä»£ç æ—¶åˆ›å»ºçš„å‡½æ•°ä½œç”¨åŸŸå˜å¤šï¼Œå¯¼è‡´å†…å­˜å¼€é”€å˜å¤§ã€‚</strong></p>\n<p>è§£å†³ä¸Šé¢é—®é¢˜çš„æ–¹æ³•å°±æ˜¯ scope hoisting</p>\n<h2>Scope hoisting</h2>\n<p>ä½¿ç”¨ scope hoisting æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ webpack è‡ªå¸¦çš„ ModuleConcatenationPlugin æ’ä»¶å¼€å¯</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>optimize<span class=\"token punctuation\">.</span>ModuleConcatenationPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>webpack æ„å»ºé¡¹ç›®ç”Ÿäº§ç¯å¢ƒé»˜è®¤å¼€å¯(mode:production)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  mode<span class=\"token punctuation\">:</span> <span class=\"token string\">'production'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¯åŠ¨ä¸€ä¸‹å…ˆæ¥çœ‹æ‰“åŒ…ç»“æœ</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">modules</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> installedModules <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">__webpack_require__</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">moduleId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>installedModules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> installedModules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>exports\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> module <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>installedModules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      i<span class=\"token punctuation\">:</span> moduleId<span class=\"token punctuation\">,</span>\n      l<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      exports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    modules<span class=\"token punctuation\">[</span>moduleId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>\n      module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>\n      module<span class=\"token punctuation\">,</span>\n      module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>\n      __webpack_require__\n    <span class=\"token punctuation\">)</span>\n\n    module<span class=\"token punctuation\">.</span>l <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token keyword\">return</span> module<span class=\"token punctuation\">.</span>exports\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">__webpack_require__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>__webpack_require__<span class=\"token punctuation\">.</span>s <span class=\"token operator\">=</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/***/</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">/***/</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">module<span class=\"token punctuation\">,</span>\n    __webpack_exports__<span class=\"token punctuation\">,</span>\n    __webpack_require__</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'use strict'</span>\n    <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'__webpack_require__.r(__webpack_exports__);\\n\\n// CONCATENATED MODULE: ./src/sum.js\\n// sum.js\\n/* harmony default export */ var sum = (arr => arr.reduce((pre, item) => pre + item, 0));\\n\\n// CONCATENATED MODULE: ./src/add.js\\n// add.js\\n/* harmony default export */ var add = ((a, b) => a + b);\\n\\n// CONCATENATED MODULE: ./src/index.js\\n\\n\\n\\nlet a = 1,\\n  b = 2,\\n  arr = [1, 2, 3, 4, 5]\\n\\nconsole.log(add(a, b))\\nconsole.log(sum(arr))\\n\\n\\n//# sourceURL=webpack:///./src/index.js_+_2_modules?'</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">/***/</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ä½ ä¼šå‘ç°ï¼Œä½¿ç”¨ scope hoisting æ–¹å¼ï¼ŒIIFE å˜æˆä¸€ä¸ªäº†(åŸæ¥æœ‰ 3 ä¸ª)ï¼Œadd.js å’Œ sum.js é‡Œé¢çš„ä»£ç è¢«æ‰“åŒ…åˆ° äº† index.js ä¸­ï¼Œå‡å°‘äº† IIFE çš„æ•°é‡ã€‚</p>\n<blockquote>\n<p>åŸç†ï¼š scope hoisting å°†æ‰€æœ‰å¼•å…¥çš„æ¨¡å—æŒ‰ç…§é¡ºåºæ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œé¢ï¼Œç„¶åé€‚å½“çš„é‡å‘½åä¸€äº›å˜é‡ä»¥é˜²æ­¢å˜é‡åå†²çªã€‚(æ€»ç»“ä¸€å¥ï¼šå¼•ç”¨ä¸€æ¬¡å°±å†…è”è¿›æ¥ï¼Œå‡å°‘ IIFE çš„æ•°é‡)</p>\n</blockquote>\n<h2>æ€»ç»“</h2>\n<p>ä»¥ä¸Šå°±æ˜¯ IIFE çš„ä½¿ç”¨æ–¹å¼ï¼Œå¯¹æ¯”ä¸€ä¸‹æ²¡æœ‰ scope hoisting çš„çŠ¶æ€ï¼šå‡å°‘äº†å‡½æ•°å£°æ˜ä»£ç ä»è€Œå‡å°‘äº†å‡½æ•°ä½œç”¨åŸŸçš„ç”Ÿæˆï¼Œé™ä½äº†å†…å­˜å¼€é”€ã€‚</p>","frontmatter":{"title":"Webpackæ¨¡å—åŒ–çš„é—®é¢˜åŠScope hoistingåŸç†","date":"October 11, 2019","description":"åˆ†æwebpackäº§å‡ºæ–‡ä»¶jsæ¨¡å—åŒ–çš„é—®é¢˜ï¼Œæ¢ç©¶Scope hoistingæ€ä¹ˆè§£å†³","category":"Webpack"}}},"pageContext":{"slug":"/content/Webpack/webpack-scope-hoisting/","previous":{"fields":{"slug":"/content/Webpack/webpack-mpa-solution/"},"frontmatter":{"title":"webpackå¤šé¡µé¢æ‰“åŒ…æ–¹æ¡ˆ"}},"next":{"fields":{"slug":"/content/Test/optimize-test-benchmark/"},"frontmatter":{"title":"Benchmarkå†™æ€§èƒ½æµ‹è¯•"}}}}}